{{!
  Copyright (c) HashiCorp, Inc.
  SPDX-License-Identifier: MPL-2.0
}}

{{#if @model.isOIDC}}
  {{!
    State change dropdown employs a true form and radio fields,
    which are not directly support by HDS dropdown.  The cost of building
    custom support in HDS dropdown for this case outweights the benefit.
    Aesthetically, this dropdown is suitable for use next to its HDS
    couterpart and does not appear out of place.
  }}
  <Rose::Dropdown
    @text={{t (concat 'states.' @model.state)}}
    @icon={{if
      @model.isInactive
      'flight-icons/svg/x-circle-16'
      (if
        @model.isPrivate
        'flight-icons/svg/lock-16'
        'flight-icons/svg/check-circle-16'
      )
    }}
    @dropdownRight={{true}}
    as |dropdown|
  >
    <dropdown.section @title={{t 'actions.change-state'}}>
      <Rose::Form as |form|>
        <form.radioGroup
          @name='theme'
          @selectedValue={{@model.state}}
          @changed={{route-action 'changeState'}}
          as |radioGroup|
        >
          {{#each @model.options.oidc.state as |state|}}
            <dropdown.item>
              <radioGroup.radio
                @label={{t (concat 'states.' state)}}
                @value={{state}}
              />
            </dropdown.item>
          {{/each}}
        </form.radioGroup>
      </Rose::Form>
    </dropdown.section>
  </Rose::Dropdown>
{{/if}}

<Hds::Dropdown as |dd|>

  <dd.ToggleButton @text={{t 'actions.manage'}} @color='secondary' />

  {{#if @model.isPrimary}}
    <dd.Interactive
      disabled={{@model.canSave}}
      @text={{t 'resources.auth-method.actions.remove-as-primary'}}
      @icon='x'
      {{on 'click' (route-action 'removeAsPrimary' @model)}}
    />
  {{else}}
    <dd.Interactive
      disabled={{@model.canSave}}
      @text={{t 'resources.auth-method.actions.make-primary'}}
      @icon='verified'
      {{on 'click' (route-action 'makePrimary' @model)}}
    />
  {{/if}}

  {{#if (can 'create model' @model collection='accounts')}}
    <dd.Interactive
      disabled={{@model.canSave}}
      @text={{t 'resources.account.actions.create'}}
      @icon='user-plus'
      @route='scopes.scope.auth-methods.auth-method.accounts.new'
      @model={{@model}}
    />
  {{/if}}

  {{#if (can 'create model' @model collection='managed-groups')}}
    {{#if @model.isOIDC}}
      <dd.Interactive
        disabled={{@model.canSave}}
        @text={{t 'resources.managed-group.actions.create'}}
        @icon='folder-plus'
        @route='scopes.scope.auth-methods.auth-method.managed-groups.new'
        @model={{@model}}
      />
    {{/if}}
  {{/if}}

  {{#if (can 'delete auth-method' @model)}}
    <dd.Separator />
    <dd.Interactive
      disabled={{@model.canSave}}
      @text={{t 'resources.auth-method.actions.delete'}}
      @color='critical'
      @icon='trash'
      {{on 'click' (route-action 'delete' @model)}}
    />
  {{/if}}

</Hds::Dropdown>