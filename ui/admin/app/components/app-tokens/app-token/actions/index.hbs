{{!
  Copyright (c) HashiCorp, Inc.
  SPDX-License-Identifier: BUSL-1.1
}}

{{#let
  (hash
    canClone=(can 'clone app-token' @model)
    canRevoke=(can 'revoke app-token' @model)
    canDelete=(can 'delete app-token' @model)
  )
  as |perms|
}}
  {{#if (or perms.canClone perms.canRevoke perms.canDelete)}}
    <Hds::Dropdown data-test-manage-app-token as |dd|>
      <dd.ToggleButton @text={{t 'actions.manage'}} @color='secondary' />
      {{#if perms.canClone}}
        <dd.Interactive
          data-test-manage-app-token-clone
          @route='scopes.scope.app-tokens.new'
          @query={{hash cloneAppToken=@model.id}}
        >
          {{t 'actions.clone-app-token'}}
        </dd.Interactive>
      {{/if}}
      {{#if perms.canRevoke}}
        <dd.Interactive
          data-test-manage-app-token-revoke
          {{on 'click' this.toggleRevokeAppTokenModal}}
        >
          {{t 'actions.revoke-app-token'}}
        </dd.Interactive>
      {{/if}}
      {{#if perms.canDelete}}
        {{#if (or perms.canClone perms.canRevoke)}}
          <dd.Separator />
        {{/if}}
        <dd.Interactive
          data-test-manage-app-token-delete
          @color='critical'
          {{on 'click' this.toggleDeleteAppTokenModal}}
        >
          {{t 'resources.app-token.actions.delete'}}
        </dd.Interactive>
      {{/if}}
    </Hds::Dropdown>
  {{/if}}
{{/let}}

{{#if this.showRevokeAppTokenModal}}
  <Hds::Modal
    @color='critical'
    @onClose={{this.toggleRevokeAppTokenModal}}
    as |M|
  >
    <M.Header @icon='alert-diamond'>{{t
        'resources.app-token.form.revoke.title'
      }}</M.Header>
    <M.Body class='app-token-modal-body'>
      <Hds::Text::Body @tag='p'>
        {{t
          'resources.app-token.form.revoke.description.0'
          appToken=@model.displayName
          htmlSafe=true
        }}
      </Hds::Text::Body>
      <Hds::Text::Body @tag='p'>
        {{t 'resources.app-token.form.revoke.description.1'}}
      </Hds::Text::Body>
      <Hds::Form::TextInput::Field
        name='confirm-revoke'
        @value={{this.revokeConfirmation}}
        @isRequired={{true}}
        disabled={{@model.isSaving}}
        {{on 'input' (set-from-event this 'revokeConfirmation')}}
        as |F|
      >
        <F.Label>{{t
            'resources.app-token.form.revoke.confirm-revoke.label'
          }}</F.Label>
        <F.HelperText>{{t
            'resources.app-token.form.revoke.confirm-revoke.help'
          }}</F.HelperText>
      </Hds::Form::TextInput::Field>
    </M.Body>
    <M.Footer as |F|>
      <Hds::ButtonSet>
        <Hds::Button
          @text={{t 'actions.confirm'}}
          @color='critical'
          disabled={{not this.isRevokeConfirmed}}
          {{on 'click' this.handleRevoke}}
        />
        <Hds::Button
          @text={{t 'actions.cancel'}}
          @color='secondary'
          {{on 'click' F.close}}
        />
      </Hds::ButtonSet>
    </M.Footer>
  </Hds::Modal>
{{/if}}

{{#if this.showDeleteAppTokenModal}}
  <Hds::Modal
    @color='critical'
    @onClose={{this.toggleDeleteAppTokenModal}}
    as |M|
  >
    <M.Header @icon='alert-diamond'>{{t
        'resources.app-token.form.delete.title'
      }}</M.Header>
    <M.Body class='app-token-modal-body'>
      <Hds::Text::Body @tag='p'>
        {{t
          'resources.app-token.form.delete.description.0'
          appToken=@model.displayName
          htmlSafe=true
        }}
      </Hds::Text::Body>
      <Hds::Text::Body @tag='p'>
        {{t 'resources.app-token.form.delete.description.1'}}
      </Hds::Text::Body>
      <Hds::Form::TextInput::Field
        name='confirm-delete'
        @value={{this.deleteConfirmation}}
        @isRequired={{true}}
        disabled={{@model.isSaving}}
        {{on 'input' (set-from-event this 'deleteConfirmation')}}
        as |F|
      >
        <F.Label>{{t
            'resources.app-token.form.delete.confirm-delete.label'
          }}</F.Label>
        <F.HelperText>{{t
            'resources.app-token.form.delete.confirm-delete.help'
          }}</F.HelperText>
      </Hds::Form::TextInput::Field>
    </M.Body>
    <M.Footer as |F|>
      <Hds::ButtonSet>
        <Hds::Button
          @text={{t 'actions.confirm'}}
          @color='critical'
          disabled={{not this.isDeleteConfirmed}}
          {{on 'click' this.handleDelete}}
        />
        <Hds::Button
          @text={{t 'actions.cancel'}}
          @color='secondary'
          {{on 'click' F.close}}
        />
      </Hds::ButtonSet>
    </M.Footer>
  </Hds::Modal>
{{/if}}