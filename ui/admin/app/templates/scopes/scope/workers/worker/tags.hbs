{{!
  Copyright (c) HashiCorp, Inc.
  SPDX-License-Identifier: BUSL-1.1
}}

{{page-title (t 'resources.worker.tags.title_plural')}}
<Breadcrumbs::Item
  @text={{t 'resources.worker.tags.title_plural'}}
  @route='scopes.scope.workers.worker.tags'
/>

<Rose::Layout::Page as |page|>

  <page.breadcrumbs>
    <Breadcrumbs::Container />
  </page.breadcrumbs>

  <page.header>
    <Workers::Worker::Header @model={{@model}} />
  </page.header>

  <page.navigation>
    <Workers::Worker::Nav />
  </page.navigation>

  <page.actions>
    <Workers::Worker::Actions
      @model={{@model}}
      @delete={{this.workers.delete}}
    />
  </page.actions>

  <page.body>
    {{#if @model.allTags}}
      <Hds::Table
        @model={{@model.allTags}}
        @columns={{array
          (hash label=(t 'resources.worker.table.key'))
          (hash label=(t 'resources.worker.table.value'))
          (hash label=(t 'resources.worker.table.type'))
          (hash label=(t 'titles.actions') isVisuallyHidden=true width='60px')
        }}
        @valign='middle'
      >
        <:body as |B|>
          <B.Tr>
            <B.Td>
              <Hds::Text::Code @tag='pre'>{{B.data.key}}</Hds::Text::Code>
            </B.Td>
            <B.Td>
              <Hds::Text::Code @tag='pre'>{{B.data.value}}</Hds::Text::Code>
            </B.Td>
            <B.Td>
              {{#if (eq B.data.type this.tagTypeConfig)}}
                <Hds::TooltipButton
                  @text={{t 'resources.worker.tooltip'}}
                  @offset={{array -50 8}}
                >
                  <Hds::Badge @text={{B.data.type}} />
                </Hds::TooltipButton>
              {{else}}
                <Hds::Badge @text={{B.data.type}} />
              {{/if}}
            </B.Td>
            <B.Td>
              {{#if (eq B.data.type this.tagTypeApi)}}
                <Hds::Dropdown as |dd|>
                  <dd.ToggleIcon
                    @icon='more-horizontal'
                    @text='Overflow Options'
                    @hasChevron={{false}}
                    @size='small'
                  />
                  {{#if (can 'removeTags worker' @model)}}
                    <dd.Interactive
                      @text={{t 'resources.worker.tags.actions.remove'}}
                      {{on 'click' (fn this.toggleModal 'remove' B.data)}}
                    />
                  {{/if}}
                </Hds::Dropdown>
              {{/if}}
            </B.Td>
          </B.Tr>
        </:body>
      </Hds::Table>
    {{/if}}

    {{#if this.modals.remove}}
      <Hds::Modal
        id='remove-tag-modal'
        @color='critical'
        @onClose={{fn this.toggleModal 'remove'}}
        as |M|
      >
        <M.Header @icon='alert-diamond'>
          {{t 'resources.worker.tags.remove.title'}}
        </M.Header>
        <M.Body>
          <Hds::Text::Body @color='primary'>
            {{this.tagDisplayName}}
            {{t 'resources.worker.tags.remove.warning'}}
          </Hds::Text::Body>
          <Hds::Form::TextInput::Field
            name='removal-confirmation'
            @value={{this.removalConfirmation}}
            {{on 'input' (set-from-event this 'removalConfirmation')}}
            as |F|
          >
            <F.Label>{{t
                'resources.worker.tags.remove.confirm.label'
              }}</F.Label>
            <F.HelperText>{{t
                'resources.worker.tags.remove.confirm.help'
              }}</F.HelperText>
          </Hds::Form::TextInput::Field>
        </M.Body>
        <M.Footer as |F|>
          <Hds::ButtonSet>
            <Hds::Button
              type='button'
              disabled={{(not this.isRemovalConfirmed)}}
              @color='critical'
              @text='Remove'
              {{on 'click' this.removeApiTag}}
            />
            <Hds::Button
              type='button'
              @color='secondary'
              @text='Cancel'
              {{on 'click' F.close}}
            />
          </Hds::ButtonSet>
        </M.Footer>
      </Hds::Modal>
    {{/if}}

  </page.body>

</Rose::Layout::Page>