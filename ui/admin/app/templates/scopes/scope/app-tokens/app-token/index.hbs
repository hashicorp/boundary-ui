{{!
  Copyright (c) HashiCorp, Inc.
  SPDX-License-Identifier: BUSL-1.1
}}

<Rose::Layout::Page as |page|>
  <page.header>
    <Hds::PageHeader as |PH|>
      <PH.Breadcrumb>
        <Breadcrumbs::Container />
      </PH.Breadcrumb>
      <PH.Title>
        {{t 'resources.app-token.title_plural'}}
        <DocLink @doc='app-tokens' />
      </PH.Title>
      <PH.Description>
        {{t 'resources.app-token.description'}}
      </PH.Description>
      <PH.Actions>
        <AppTokens::AppToken::Actions
          @model={{@model}}
          @revoke={{fn this.appTokens.revoke @model}}
          @delete={{fn this.appTokens.delete @model}}
        />
      </PH.Actions>
      <PH.Generic>
        <Hds::Copy::Snippet @textToCopy={{@model.id}} @color='secondary' />
      </PH.Generic>
    </Hds::PageHeader>
  </page.header>

  <page.navigation>
    <AppTokens::AppToken::Nav />
  </page.navigation>

  <page.body>
    {{! Delete Original App Token Banner - shown after cloning an inactive token }}
    {{#if this.clonedFromId}}
      <Hds::Alert
        class='margin-bottom-m'
        @type='inline'
        @color='warning'
        @onDismiss={{this.dismissClonedFromBanner}}
        data-test-delete-original-banner
        as |A|
      >
        <A.Title>{{t
            'resources.app-token.messages.delete-original.title'
          }}</A.Title>
        <A.Description>
          {{t
            'resources.app-token.messages.delete-original.description'
            originalTokenName=this.clonedFromName
            statusText=this.originalTokenStatusText
            htmlSafe=true
          }}
        </A.Description>
        <A.Button
          @color='secondary'
          @text={{t 'actions.delete'}}
          @icon='trash'
          data-test-delete-original-btn
          {{on 'click' this.toggleDeleteOriginalModal}}
        />
      </Hds::Alert>
    {{/if}}

    {{! Inactive Token Alert - shown when viewing a stale/expired/revoked token }}
    {{#unless @model.isActive}}
      <Hds::Alert
        class='margin-bottom-m'
        @type='inline'
        @color='warning'
        data-test-permissions-alert
        as |A|
      >
        <A.Title>{{this.statusTranslation}}</A.Title>
        <A.Description>
          {{t
            'resources.app-token.messages.inactive-alert.description'
            htmlSafe=true
          }}
        </A.Description>
        {{#if (can 'clone app-token' @model)}}
          <A.Button
            @color='secondary'
            @text={{t 'resources.app-token.actions.clone'}}
            @route='scopes.scope.app-tokens.new'
            @query={{hash cloneAppToken=@model.id}}
            data-test-inline-clone-btn
          />
        {{/if}}
        {{#if (can 'delete app-token' @model)}}
          <A.Button
            @color='tertiary'
            @text={{t 'resources.app-token.actions.delete'}}
            @icon='trash'
            data-test-inline-delete-btn
            {{on 'click' this.toggleDeleteModal}}
          />
        {{/if}}
      </Hds::Alert>
    {{/unless}}
    <Form::AppToken::Read
      @model={{@model}}
      @showCreatedAppToken={{this.showCreatedAppToken}}
      @resetAppTokenModal={{this.resetAppTokenModal}}
    />
  </page.body>
</Rose::Layout::Page>

{{! Delete Modal - triggered from inactive alert or delete original banner }}
{{#if this.showDeleteModal}}
  <Hds::Modal @color='critical' @onClose={{this.toggleDeleteModal}} as |M|>
    <M.Header @icon='alert-diamond'>{{t
        'resources.app-token.form.delete.title'
      }}</M.Header>
    <M.Body class='app-token-modal-body'>
      <Hds::Text::Body @tag='p'>
        {{t
          'resources.app-token.form.delete.description.0'
          appToken=this.deleteTokenDisplayName
          htmlSafe=true
        }}
      </Hds::Text::Body>
      <Hds::Text::Body @tag='p'>
        {{t 'resources.app-token.form.delete.description.1'}}
      </Hds::Text::Body>
      <Hds::Form::TextInput::Field
        name='confirm-delete'
        @value={{this.deleteConfirmation}}
        @isRequired={{true}}
        disabled={{@model.isSaving}}
        {{on 'input' (set-from-event this 'deleteConfirmation')}}
        as |F|
      >
        <F.Label>{{t
            'resources.app-token.form.delete.confirm-delete.label'
          }}</F.Label>
        <F.HelperText>{{t
            'resources.app-token.form.delete.confirm-delete.help'
          }}</F.HelperText>
      </Hds::Form::TextInput::Field>
    </M.Body>
    <M.Footer as |F|>
      <Hds::ButtonSet>
        <Hds::Button
          @text={{t 'actions.confirm'}}
          @color='critical'
          disabled={{not this.isDeleteConfirmed}}
          {{on 'click' this.handleDelete}}
        />
        <Hds::Button
          @text={{t 'actions.cancel'}}
          @color='secondary'
          {{on 'click' F.close}}
        />
      </Hds::ButtonSet>
    </M.Footer>
  </Hds::Modal>
{{/if}}